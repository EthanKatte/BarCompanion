{% extends "base.html" %}

{% block title %}Event Console - {{ event.code }}{% endblock %}

{% block content %}
<div class="container mx-auto py-8">

  <!-- QR Code Section -->
  <div class="flex flex-col items-center mb-12">
    <h2 class="text-2xl font-bold mb-4 text-center">Event QR Code</h2>
    <div
      id="qrcode"
      class="border-4 border-dashed p-8 rounded-lg shadow-lg bg-white  w-[480] h-[480]"
    ></div>
  </div>

  <div class="container mx-auto py-8">
    <h2 class="text-2xl font-bold mb-4">Event Photo Gallery</h2>
    <div class="grid grid-cols-3 gap-4">
      {% for image in images %}
      <!-- Image Card -->
      <label for="imageModal-{{ image }}" class="card bg-base-100 shadow-md cursor-pointer">
        <figure>
          <img
            src="{{ image }}"
            alt="Event Photo"
            class="w-full h-48 object-cover rounded-md"
          />
        </figure>
      </label>
  
      <!-- Modal -->
      <input type="checkbox" id="imageModal-{{ image }}" class="modal-toggle" />
      <div class="modal">
        <div class="modal-box relative">
          <label for="imageModal-{{ image }}" class="btn btn-sm btn-circle absolute right-2 top-2">âœ•</label>
          <img
            src="{{ image }}"
            alt="Large View"
            class="w-full h-auto rounded-lg shadow-lg"
          />
        </div>
        <label for="imageModal-{{ image }}" class="modal-backdrop"></label>
      </div>
      {% endfor %}
    </div>

  </div>
  
  

  <!-- Event Bottles -->

  <div class="mb-6">
    <div class="grid-cols-2">
        <h2 class="text-2xl font-bold mb-4">Event Bottles</h2>
        <!-- Trigger Button for Modal -->
        <button class="btn btn-primary mb-4" onclick="document.getElementById('add-bottle-modal').checked = true;">
            Add Bottles
        </button>
        {% include "modals/add_event_bottle_button.html" %}
    </div>

    <div class="grid grid-cols-3 gap-6">
        {% for bottle in event.bottles %}
        <label for="bottle-modal-{{ bottle.id }}" class="cursor-pointer bg-white shadow-md rounded-lg overflow-hidden border border-gray-200">
          <!-- Bottle Image -->
          <div class="p-4">
            <img
              src="/database_images/bottles/{{ bottle.image_path }}"
              alt="{{ bottle.brand }} - {{ bottle.name }}"
              class="w-full h-48 object-contain rounded-md"
            />
          </div>
      
          <!-- Bottle Details -->
          <div class="p-4 text-center">
            <h3 class="font-bold text-lg mb-2">{{ bottle.brand }} - {{ bottle.name }}</h3>
            <p class="text-gray-600 text-sm">ABV: {{ bottle.abv }}</p>
            <p class="text-gray-600 text-sm">{{ bottle.description }}</p>
          </div>
        </label>
        {% include "modals/event_console_bottle_popup.html" %}
        {% endfor %}
      </div>
      

  </div>

  <!-- Event user -->
  <div>
    <h2 class="text-2xl font-bold mb-4">Event Participants</h2>
        <button class="btn btn-primary mb-4" onclick="document.getElementById('add-user-modal').checked = true;">
            Add Participant
        </button>
        {% include "modals/add_event_user_button.html" %}
    <div class="grid grid-cols-3 gap-6">
      {% for user in event.users %}
      <script>console.log("users: {{ event.users}}");</script>
      <label for="user-modal-{{ user.id }}" class="cursor-pointer bg-white shadow-md rounded-lg overflow-hidden border border-gray-200">
        <figure>
          <img
            src="/database_images/users/{{ user.image_path }}"
            alt="{{ user.name }}"
            class="w-[250px] h-[250px] object-contain mx-auto bg-gray-100"
          />
        </figure>
        <div class="card-body">
          <h2 class="card-title">{{ user.name }}</h2>
        </div>
      </label>
      {% include "modals/event_user_popup.html" %}
      {% endfor %}
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
  setInterval(() => {
    location.reload();
  }, 150000);

  document.addEventListener("DOMContentLoaded", () => {
    // Generate QR Code
    const qrCodeContainer = document.getElementById("qrcode");
    const url = `/event?id={{ event.id }}&version=client`;
    new QRCode(qrCodeContainer, {
      text: url,
      width: 400,
      height: 400,
    });

    // Camera setup
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const photoData = document.getElementById("photo-data");
    const captureButton = document.getElementById("capture-button");

    // Access the camera
    navigator.mediaDevices
      .getUserMedia({ video: true })
      .then((stream) => {
        video.srcObject = stream;
      })
      .catch((err) => {
        console.error("Camera access denied:", err);
        showAlert("Unable to access the camera. Please check your device permissions.", "error");
      });
  });
</script>
{% endblock %}
