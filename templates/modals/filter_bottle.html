<input type="checkbox" id="filter-bottles-modal" class="modal-toggle" />
<div class="modal">
  <div class="modal-box">
    <!-- Filter by Brand -->
    <div class="form-control">
      <label class="label">
        <span class="label-text">Filter by Brand</span>
      </label>

      {% set brand_ns = namespace(brands=[]) %}
      {% for bottle in bottles %}
        {% if bottle.brand and bottle.brand.strip() and bottle.brand not in brand_ns.brands %}
          {% set _ = brand_ns.brands.append(bottle.brand.strip()) %}
        {% endif %}
      {% endfor %}
      {% set sorted_brands = brand_ns.brands | sort %}

      <select id="filter-brand" class="select select-bordered">
        <option value="">All Brands</option>
        {% for brand in sorted_brands %}
          <option value="{{ brand }}">{{ brand }}</option>
        {% endfor %}
      </select>
    </div>
  
    <!-- Filter by Type -->
    <div class="form-control">
      <label class="label">
        <span class="label-text">Filter by Type</span>
      </label>

      {% set type_ns = namespace(types=[]) %}
      {% for bottle in bottles %}
        {% if bottle.spirit_type and bottle.spirit_type.strip() and bottle.spirit_type.strip() not in type_ns.types %}
          {% set _ = type_ns.types.append(bottle.spirit_type.strip()) %}
        {% endif %}
      {% endfor %}
      {% set sorted_types = type_ns.types | sort %}

      <select id="filter-type" class="select select-bordered">
        <option value="">All Types</option>
        {% for type in sorted_types %}
          <option value="{{ type }}">{{ type }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Filter by Sub Type -->
    <div class="form-control">
        <label class="label">
            <span class="label-text">Filter by Subtype</span>
        </label>
        <select id="filter-subtype" class="select select-bordered">
            <option value="">All Subtypes</option>
            {% for bottle in bottles %}
              {% if bottle.subtype != "" %}
                <option value="{{ bottle.subtype }}">{{ bottle.subtype }}</option>
              {% endif %}
            {% endfor %}
        </select>
        </div>
  
    <!-- Sort By -->
    <div class="form-control">
      <label class="label">
        <span class="label-text">Sort By</span>
      </label>
      <select id="sort-by" class="select select-bordered">
        <option value="name">Name</option>
        <option value="brand">Brand</option>
        <option value="abv">ABV</option>
      </select>
    </div>
  
    <!-- Order -->
    <div class="form-control">
      <label class="label">
        <span class="label-text">Order</span>
      </label>
      <select id="order" class="select select-bordered">
        <option value="asc">Ascending</option>
        <option value="desc">Descending</option>
      </select>
    </div>
  
    <!-- Apply Filters Button -->
    <button class="btn btn-primary mt-4" onclick="applyFilters()">Apply Filters</button>
    <script>
        function applyFilters() {
          const brand = document.getElementById("filter-brand").value;
          const type = document.getElementById("filter-type").value;
          const subtype = document.getElementById("filter-subtype").value;
          const sortBy = document.getElementById("sort-by").value;
          const order = document.getElementById("order").value;
      
          // Build query parameters
          const params = new URLSearchParams({
            brand: brand || "",
            type: type || "",
            subtype: subtype || "",
            sort_by: sortBy,
            order: order,
          });
      
          // Redirect to the inventory endpoint with query parameters
          window.location.href = `/inventory?${params.toString()}`;
        }
      </script>
  </div>
  <label for="filter-bottles-modal" class="modal-backdrop"></label>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const removeDuplicateOptions = (selectId) => {
      const select = document.getElementById(selectId);
      const seenValues = new Set();

      Array.from(select.options).forEach((option) => {
        if (seenValues.has(option.value) && option.value !== "") {
          option.remove();
        } else {
          seenValues.add(option.value);
        }
      });
    };

    // Remove duplicates for each select dropdown
    removeDuplicateOptions("filter-brand");
    removeDuplicateOptions("filter-type");
    removeDuplicateOptions("filter-subtype");
  });


</script>
