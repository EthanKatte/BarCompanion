<input type="checkbox" id="add-user-modal" class="modal-toggle" />
<div class="modal">
  <div class="modal-box">
    <h3 class="font-bold text-lg">Add a New User</h3>
    <form id="addUserForm" class="space-y-4">
      <!-- Name -->
      <div class="form-control">
        <label class="label">
          <span class="label-text">Name</span>
        </label>
        <input type="text" name="name" id="user-name" class="input input-bordered" required />
      </div>

      <!-- File Upload -->
      <div class="form-control">
        <label class="label">
          <span class="label-text">Upload Image</span>
        </label>
        <input type="file" name="photo" id="image-upload" class="file-input file-input-bordered" accept="image/*" required />
      </div>

      <!-- Submit Button -->
      <div class="modal-action">
        <button type="submit" class="btn btn-primary">Add User</button>
        <label for="add-user-modal" class="btn">Cancel</label>
      </div>
    </form>
  </div>
</div>

<script>
  document.getElementById("addUserForm").addEventListener("submit", async function (e) {
    e.preventDefault(); // Prevent the default form submission

    // Get form data
    const nameInput = document.getElementById("user-name");
    const fileInput = document.getElementById("image-upload");
    const file = fileInput.files[0];

    if (!nameInput.value || !file) {
      alert("Please provide a name and upload an image.");
      return;
    }

    // Convert the image file to Base64
    const base64Image = await fileToBase64(file);

    // Prepare the JSON payload
    const payload = {
      name: nameInput.value,
      photo: base64Image,
    };

    try {
      showLoadingOverlay();
      // Send the POST request
      const response = await fetch("http://192.168.0.145:5000/api/add_user", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(payload),
      });

      if (response.ok) {
        const result = await response.json();
        showAlert("User added successfully!");
        console.log("Server Response:", result);
        document.getElementById("addUserForm").reset(); // Reset the form
        document.getElementById("add-user-modal").checked = false; // Close the modal
        location.reload();
      } else {
        const error = await response.json();
        showAlert("Failed to add user: " + (error.error || "Unknown error"));
      }
    } catch (error) {
      console.error("Error submitting form:", error);
      showAlert("An error occurred while submitting the form.");
    }
    hideLoadingOverlay();
  });

  // Helper function to convert a file to Base64
  function fileToBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = (error) => reject(error);
      reader.readAsDataURL(file); // Read the file as a Base64 string
    });
  }
</script>
